<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminders Vault - Modern Task Management</title>
    <meta name="description" content="A modern, beautiful reminder and task management application">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Critical CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Module preloads for performance -->
    <link rel="modulepreload" href="js/AppController.js">
    <link rel="modulepreload" href="js/services/AuthService.js">
    <link rel="modulepreload" href="js/config/constants.js">
    <link rel="modulepreload" href="js/utils.js">

    <!-- Progressive Web App meta -->
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
<div id="app">
    <!-- Loading Screen with Modern Design -->
    <div class="loading-screen" id="loadingScreen" aria-live="polite">
        <div class="loading-content">
            <div class="app-logo">
                <div class="logo-icon" role="img" aria-label="Application logo">üìù</div>
                <h1>Reminders Vault</h1>
                <p>Modern Task Management</p>
            </div>

            <div class="loading-animation">
                <div class="modern-spinner" aria-label="Loading"></div>
                <p id="loadingText" class="loading-text">Initializing your workspace...</p>
            </div>

            <div class="loading-progress">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="progressText" class="progress-text">0%</div>
            </div>
        </div>

        <!-- Animated Background Elements -->
        <div class="floating-shapes" aria-hidden="true">
            <div class="floating-shape shape-1"></div>
            <div class="floating-shape shape-2"></div>
            <div class="floating-shape shape-3"></div>
            <div class="floating-shape shape-4"></div>
        </div>
    </div>

    <!-- Error Boundary for Graceful Failures -->
    <div id="errorBoundary" class="error-boundary" style="display: none;" role="alert">
        <div class="error-content">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h2>Something went wrong</h2>
            <p id="errorMessage">We're having trouble loading the application.</p>
            <div class="error-actions">
                <button id="retryBtn" class="btn btn-primary">Try Again</button>
                <button id="reportBtn" class="btn btn-secondary">Report Issue</button>
            </div>
        </div>
    </div>
</div>

<!-- Critical CSS for loading screen -->
<style>
    .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        animation: fadeIn 0.5s ease-in-out;
        overflow: hidden;
    }

    .loading-content {
        text-align: center;
        color: white;
        position: relative;
        z-index: 2;
        max-width: 400px;
        padding: 2rem;
    }

    .app-logo {
        margin-bottom: 3rem;
    }

    .logo-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: logoFloat 3s ease-in-out infinite;
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }

    .app-logo h1 {
        font-size: 2.5rem;
        font-weight: 300;
        margin: 0 0 0.5rem 0;
        letter-spacing: -1px;
        text-shadow: 0 2px 20px rgba(0,0,0,0.3);
    }

    .app-logo p {
        font-size: 1rem;
        opacity: 0.9;
        font-weight: 400;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin: 0;
    }

    .loading-animation {
        margin-bottom: 2rem;
    }

    .modern-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255,255,255,0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem auto;
    }

    .loading-text {
        font-size: 1rem;
        opacity: 0.8;
        font-weight: 500;
        animation: textPulse 2s ease-in-out infinite;
        margin: 0;
    }

    .loading-progress {
        margin-top: 2rem;
    }

    .progress-bar {
        width: 100%;
        height: 4px;
        background: rgba(255,255,255,0.2);
        border-radius: 2px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00ff88, #00d4ff);
        border-radius: 2px;
        width: 0%;
        transition: width 0.3s ease;
        box-shadow: 0 0 10px rgba(0,255,136,0.5);
    }

    .progress-text {
        font-size: 0.875rem;
        opacity: 0.7;
        margin: 0;
    }

    .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .floating-shape {
        position: absolute;
        opacity: 0.1;
        animation: shapeFloat 8s ease-in-out infinite;
    }

    .shape-1 {
        top: 10%;
        left: 10%;
        width: 120px;
        height: 120px;
        background: white;
        border-radius: 50%;
        animation-delay: -2s;
    }

    .shape-2 {
        top: 20%;
        right: 10%;
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
        animation-delay: -4s;
    }

    .shape-3 {
        bottom: 20%;
        left: 20%;
        width: 100px;
        height: 100px;
        background: white;
        border-radius: 20% 80% 20% 80% / 80% 20% 80% 20%;
        animation-delay: -6s;
    }

    .shape-4 {
        bottom: 30%;
        right: 30%;
        width: 60px;
        height: 60px;
        background: white;
        clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        animation-delay: -1s;
    }

    .error-boundary {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }

    .error-content {
        text-align: center;
        color: white;
        max-width: 400px;
        padding: 2rem;
    }

    .error-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .error-content h2 {
        font-size: 2rem;
        margin: 0 0 1rem 0;
        font-weight: 300;
    }

    .error-content p {
        font-size: 1rem;
        margin: 0 0 2rem 0;
        opacity: 0.9;
    }

    .error-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background: white;
        color: #ff6b6b;
    }

    .btn-secondary {
        background: rgba(255,255,255,0.2);
        color: white;
        border: 2px solid rgba(255,255,255,0.3);
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    @keyframes logoFloat {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-10px) rotate(5deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes textPulse {
        0%, 100% { opacity: 0.8; }
        50% { opacity: 1; }
    }

    @keyframes shapeFloat {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-30px) rotate(180deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
        transition: all 0.5s ease-out;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .loading-content {
            padding: 1rem;
        }

        .app-logo h1 {
            font-size: 2rem;
        }

        .logo-icon {
            font-size: 3rem;
        }

        .error-actions {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
        .logo-icon,
        .modern-spinner,
        .floating-shape {
            animation: none;
        }

        .loading-text {
            animation: none;
            opacity: 1;
        }
    }
</style>

<!-- Modern ES6 Module Application -->
<script type="module">
    import { appController } from './js/AppController.js';

    class AppBootstrapper {
        #loadingMessages = [
            'Initializing services...',
            'Loading configuration...',
            'Setting up security...',
            'Preparing interface...',
            'Almost ready...'
        ];

        #currentMessageIndex = 0;
        #progressValue = 0;

        constructor() {
            this.setupErrorHandlers();
            this.startMessageRotation();
        }

        async init() {
            try {
                // Simulate initialization progress
                await this.updateProgress(20, 'Loading core modules...');

                // Initialize application controller
                await appController.init();
                await this.updateProgress(60, 'Configuring services...');

                // Setup application event listeners
                this.setupAppEventListeners();
                await this.updateProgress(80, 'Finalizing setup...');

                // Complete initialization
                await this.updateProgress(100, 'Ready!');

                // Hide loading screen after brief success display
                setTimeout(() => this.hideLoadingScreen(), 800);

            } catch (error) {
                console.error('Application initialization failed:', error);
                this.showError(error);
            }
        }

        async updateProgress(percentage, message) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const loadingText = document.getElementById('loadingText');

            if (progressFill) progressFill.style.width = `${percentage}%`;
            if (progressText) progressText.textContent = `${percentage}%`;
            if (loadingText && message) loadingText.textContent = message;

            // Small delay for visual feedback
            await new Promise(resolve => setTimeout(resolve, 300));
        }

        startMessageRotation() {
            const loadingText = document.getElementById('loadingText');
            if (!loadingText) return;

            setInterval(() => {
                if (this.#currentMessageIndex < this.#loadingMessages.length - 1) {
                    this.#currentMessageIndex++;
                    loadingText.textContent = this.#loadingMessages[this.#currentMessageIndex];
                }
            }, 1000);
        }

        setupAppEventListeners() {
            // Listen for application events
            appController.on('app:ready', (data) => {
                console.log('üéâ Application ready:', data);
            });

            appController.on('app:error', (data) => {
                console.error('Application error:', data);
                this.showError(data.error);
            });

            // Performance monitoring
            appController.on('app:performance', (data) => {
                if (data.memory?.used > 50) { // 50MB threshold
                    console.warn('High memory usage detected:', data.memory);
                }
            });
        }

        hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');

                // Remove from DOM after animation
                setTimeout(() => {
                    if (loadingScreen.parentNode) {
                        loadingScreen.remove();
                    }
                }, 500);
            }
        }

        showError(error) {
            const errorBoundary = document.getElementById('errorBoundary');
            const errorMessage = document.getElementById('errorMessage');
            const loadingScreen = document.getElementById('loadingScreen');

            if (errorMessage) {
                errorMessage.textContent = error.message || 'An unexpected error occurred.';
            }

            if (loadingScreen) loadingScreen.style.display = 'none';
            if (errorBoundary) errorBoundary.style.display = 'flex';
        }

        setupErrorHandlers() {
            // Retry button
            document.getElementById('retryBtn')?.addEventListener('click', () => {
                window.location.reload();
            });

            // Report button
            document.getElementById('reportBtn')?.addEventListener('click', () => {
                const errorDetails = {
                    userAgent: navigator.userAgent,
                    timestamp: new Date().toISOString(),
                    url: window.location.href
                };

                console.log('Error report:', errorDetails);
                alert('Error details logged to console. Please contact support.');
            });

            // Global error handlers
            window.addEventListener('error', (event) => {
                console.error('Global error:', event.error);
                this.showError(event.error || new Error('Unknown error'));
            });

            window.addEventListener('unhandledrejection', (event) => {
                console.error('Unhandled promise rejection:', event.reason);
                this.showError(new Error(event.reason || 'Promise rejection'));
            });
        }
    }

    // Initialize application when DOM is ready
    document.addEventListener('DOMContentLoaded', async () => {
        console.log('üöÄ Starting Reminders Vault...');

        const bootstrapper = new AppBootstrapper();
        await bootstrapper.init();
    });

    // Service Worker registration for PWA features
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
            try {
                await navigator.serviceWorker.register('/sw.js');
                console.log('‚úÖ Service Worker registered');
            } catch (error) {
                console.warn('Service Worker registration failed:', error);
            }
        });
    }

    // Handle app installation prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (event) => {
        event.preventDefault();
        deferredPrompt = event;

        // Show install button or notification
        console.log('App can be installed');
    });
</script>

<!-- Fallback for non-module browsers -->
<script nomodule>
    document.body.innerHTML = `
            <div style="
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex; align-items: center; justify-content: center;
                color: white; font-family: system-ui, sans-serif; text-align: center;
            ">
                <div>
                    <h1>Browser Update Required</h1>
                    <p>This application requires a modern browser that supports ES6 modules.</p>
                    <p>Please update your browser to continue.</p>
                </div>
            </div>
        `;
</script>
</body>
</html>