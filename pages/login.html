<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Reminders Vault</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/login.css">
</head>
<body>
<!-- Login Container -->
<div class="login-container">
    <!-- Header Section -->
    <header class="login-header">
        <h1>Reminders Vault</h1>
        <p>Sign in to manage your reminders</p>
    </header>

    <!-- Message Container -->
    <div id="messageContainer" class="message-container" role="alert" aria-live="polite"></div>

    <!-- Login Form -->
    <form id="loginForm" class="login-form" novalidate>
        <div class="form-group">
            <label for="username">
                <span class="label-icon" aria-hidden="true">👤</span>
                Username
            </label>
            <input
                    type="text"
                    id="username"
                    name="username"
                    required
                    autocomplete="username"
                    placeholder="Enter your username"
                    class="form-input"
            >
        </div>

        <div class="form-group">
            <label for="password">
                <span class="label-icon" aria-hidden="true">🔒</span>
                Password
            </label>
            <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    autocomplete="current-password"
                    placeholder="Enter your password"
                    class="form-input"
            >
        </div>

        <div class="form-options">
            <label class="checkbox-container">
                <input type="checkbox" id="rememberMe" name="rememberMe">
                <span class="checkbox-label">Remember me for 30 days</span>
            </label>
        </div>

        <button type="submit" class="login-btn" id="loginBtn">
            <span class="btn-text">Sign In</span>
            <span class="btn-loader" style="display: none;" aria-hidden="true">
                <span class="spinner"></span>
                Signing in...
            </span>
        </button>
    </form>

    <!-- Demo Credentials Section -->
    <section class="demo-credentials">
        <h2>Demo Accounts</h2>
        <p class="demo-description">Click any account below to auto-fill the login form</p>

        <div class="credentials-grid">
            <button
                    type="button"
                    class="credential-item"
                    data-username="admin"
                    data-password="password123"
                    aria-label="Use admin demo account"
            >
                <div class="credential-avatar">👑</div>
                <div class="credential-info">
                    <strong>Administrator</strong>
                    <span>Full system access</span>
                    <code>admin / password123</code>
                </div>
            </button>

            <button
                    type="button"
                    class="credential-item"
                    data-username="user"
                    data-password="userpass123"
                    aria-label="Use standard user demo account"
            >
                <div class="credential-avatar">👤</div>
                <div class="credential-info">
                    <strong>Standard User</strong>
                    <span>Basic features</span>
                    <code>user / userpass123</code>
                </div>
            </button>

            <button
                    type="button"
                    class="credential-item"
                    data-username="manager"
                    data-password="manager456"
                    aria-label="Use manager demo account"
            >
                <div class="credential-avatar">👥</div>
                <div class="credential-info">
                    <strong>Manager</strong>
                    <span>Team management</span>
                    <code>manager / manager456</code>
                </div>
            </button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="login-footer">
        <p>&copy; 2025 Reminders Vault. Modern task management for everyone.</p>
    </footer>
</div>

<!-- Working Login Script -->
<script>
    // ===== WORKING LOGIN CONTROLLER =====

    // App constants
    const APP_CONFIG = {
        storage: {
            keys: {
                USER_SESSION: 'user_session',
                LAST_LOGIN: 'last_login'
            }
        }
    };

    const DEMO_USERS = {
        admin: {
            id: 'admin',
            username: 'admin',
            password: 'password123',
            role: 'administrator',
            profile: {
                firstName: 'Admin',
                lastName: 'User',
                email: 'admin@example.com',
                avatar: '👑'
            }
        },
        user: {
            id: 'user',
            username: 'user',
            password: 'userpass123',
            role: 'user',
            profile: {
                firstName: 'Standard',
                lastName: 'User',
                email: 'user@example.com',
                avatar: '👤'
            }
        },
        manager: {
            id: 'manager',
            username: 'manager',
            password: 'manager456',
            role: 'manager',
            profile: {
                firstName: 'Team',
                lastName: 'Manager',
                email: 'manager@example.com',
                avatar: '👥'
            }
        }
    };

    // Storage utility
    const Storage = {
        get: (key, defaultValue = null) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch {
                return defaultValue;
            }
        },
        set: (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch {
                return false;
            }
        },
        remove: (key) => {
            try {
                localStorage.removeItem(key);
                return true;
            } catch {
                return false;
            }
        }
    };

    class LoginController {
        constructor() {
            this.isLoading = false;
            this.setupEventListeners();
            this.checkExistingSession();
        }

        checkExistingSession() {
            const session = Storage.get(APP_CONFIG.storage.keys.USER_SESSION);
            if (session && session.username) {
                console.log('Existing session found, redirecting to dashboard...');
                this.redirectToDashboard();
            }
        }

        setupEventListeners() {
            // Form submission
            const form = document.getElementById('loginForm');
            form?.addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleLogin();
            });

            // Demo credentials
            document.querySelectorAll('.credential-item').forEach(item => {
                item.addEventListener('click', () => {
                    const username = item.dataset.username;
                    const password = item.dataset.password;
                    this.fillCredentials(username, password);
                });
            });

            // Enter key on password field
            document.getElementById('password')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.handleLogin();
                }
            });

            // Real-time validation
            document.getElementById('username')?.addEventListener('input', (e) => {
                this.clearFieldError(e.target);
            });

            document.getElementById('password')?.addEventListener('input', (e) => {
                this.clearFieldError(e.target);
            });
        }

        async handleLogin() {
            if (this.isLoading) return;

            const form = document.getElementById('loginForm');
            const formData = new FormData(form);

            const credentials = {
                username: formData.get('username')?.trim(),
                password: formData.get('password'),
                rememberMe: formData.get('rememberMe') === 'on'
            };

            // Clear previous messages
            this.clearMessages();

            // Validate
            if (!this.validateCredentials(credentials)) {
                return;
            }

            // Show loading state
            this.setLoading(true);

            try {
                // Simulate network delay
                await this.delay(800);

                // Authenticate
                const user = this.authenticateUser(credentials.username, credentials.password);

                if (!user) {
                    throw new Error('Invalid username or password. Please try again.');
                }

                // Create session
                const session = this.createSession(user, credentials.rememberMe);
                Storage.set(APP_CONFIG.storage.keys.USER_SESSION, session);
                Storage.set(APP_CONFIG.storage.keys.LAST_LOGIN, new Date().toISOString());

                // Success
                this.showMessage('Login successful! Redirecting...', 'success');

                setTimeout(() => {
                    this.redirectToDashboard();
                }, 1500);

            } catch (error) {
                this.showMessage(error.message, 'error');
                this.clearPassword();
            } finally {
                this.setLoading(false);
            }
        }

        authenticateUser(username, password) {
            const user = DEMO_USERS[username];
            if (!user || user.password !== password) {
                return null;
            }
            return user;
        }

        createSession(user, rememberMe) {
            const now = new Date();
            const sessionDuration = rememberMe ? 30 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000;

            return {
                id: this.generateId(),
                username: user.username,
                role: user.role,
                profile: { ...user.profile },
                loginTime: now.toISOString(),
                expiresAt: now.getTime() + sessionDuration,
                rememberMe
            };
        }

        validateCredentials({ username, password }) {
            let isValid = true;

            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');

            if (!username) {
                this.showFieldError(usernameInput, 'Username is required');
                isValid = false;
            }

            if (!password) {
                this.showFieldError(passwordInput, 'Password is required');
                isValid = false;
            }

            return isValid;
        }

        fillCredentials(username, password) {
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');

            if (usernameInput && passwordInput) {
                usernameInput.value = username;
                passwordInput.value = password;

                this.clearFieldError(usernameInput);
                this.clearFieldError(passwordInput);

                this.showMessage('Demo credentials filled. Click "Sign In" to continue.', 'info');

                // Focus login button
                document.getElementById('loginBtn')?.focus();
            }
        }

        setLoading(loading) {
            this.isLoading = loading;

            const loginBtn = document.getElementById('loginBtn');
            const btnText = loginBtn?.querySelector('.btn-text');
            const btnLoader = loginBtn?.querySelector('.btn-loader');

            if (loginBtn) {
                loginBtn.disabled = loading;

                if (btnText && btnLoader) {
                    if (loading) {
                        btnText.style.display = 'none';
                        btnLoader.style.display = 'flex';
                    } else {
                        btnText.style.display = 'inline';
                        btnLoader.style.display = 'none';
                    }
                }
            }
        }

        showMessage(message, type = 'info') {
            const messageContainer = document.getElementById('messageContainer');
            if (!messageContainer) return;

            const messageElement = document.createElement('div');
            messageElement.className = 'message ${type}';
            messageElement.innerHTML = '
            <span class="message-icon">${this.getMessageIcon(type)}</span>
            <span class="message-text">${this.escapeHtml(message)}</span>
        ';

            messageContainer.innerHTML = '';
            messageContainer.appendChild(messageElement);
            messageContainer.style.display = 'block';

            // Auto-hide success messages
            if (type === 'success' || type === 'info') {
                setTimeout(() => {
                    this.clearMessages();
                }, 3000);
            }
        }

        clearMessages() {
            const messageContainer = document.getElementById('messageContainer');
            if (messageContainer) {
                messageContainer.innerHTML = '';
                messageContainer.style.display = 'none';
            }
        }

        showFieldError(field, message) {
            if (!field) return;

            this.clearFieldError(field);
            field.classList.add('error');

            const errorElement = document.createElement('div');
            errorElement.className = 'field-error';
            errorElement.textContent = message;
            errorElement.style.cssText = '
            color: #EF4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            font-weight: 500;
        ';

            field.parentNode.appendChild(errorElement);
        }

        clearFieldError(field) {
            if (!field) return;

            field.classList.remove('error');
            const errorElement = field.parentNode.querySelector('.field-error');
            errorElement?.remove();
        }

        clearPassword() {
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        redirectToDashboard() {
            window.location.href = 'dashboard.html';
        }

        getMessageIcon(type) {
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            return icons[type] || icons.info;
        }

        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        console.log('🔐 Initializing login page...');
        new LoginController();
    });

    // Handle browser back button
    window.addEventListener('popstate', () => {
        const session = Storage.get(APP_CONFIG.storage.keys.USER_SESSION);
        if (session) {
            window.location.href = 'dashboard.html';
        }
    });
</script>

<!-- Enhanced login styles -->
<style>
    .demo-credentials {
        margin-bottom: 2rem;
    }

    .demo-description {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
        text-align: center;
        opacity: 0.8;
    }

    .credentials-grid {
        display: grid;
        gap: 1rem;
    }

    .credential-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        text-align: left;
        width: 100%;
    }

    .credential-item:hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .credential-avatar {
        font-size: 2rem;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        flex-shrink: 0;
    }

    .credential-info {
        flex: 1;
        min-width: 0;
    }

    .credential-info strong {
        display: block;
        color: white;
        font-weight: 600;
        margin-bottom: 0.25rem;
        font-size: 1rem;
    }

    .credential-info span {
        display: block;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .credential-info code {
        display: block;
        background: rgba(0, 0, 0, 0.2);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.9);
        font-family: 'Monaco', 'Menlo', monospace;
    }

    .message-container {
        margin-bottom: 1rem;
        display: none;
    }

    .message {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        backdrop-filter: blur(10px);
    }

    .message.success {
        background: rgba(16, 185, 129, 0.9);
        color: white;
    }

    .message.error {
        background: rgba(239, 68, 68, 0.9);
        color: white;
    }

    .message.info {
        background: rgba(59, 130, 246, 0.9);
        color: white;
    }

    .field-error {
        color: #EF4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        font-weight: 500;
    }

    .form-input.error {
        border-color: #EF4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .spinner {
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 0.5rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .login-container {
            padding: 1.5rem;
            margin: 1rem;
        }

        .credential-item {
            flex-direction: column;
            text-align: center;
            gap: 0.75rem;
        }

        .credential-info code {
            font-size: 0.8rem;
        }
    }
</style>

<!-- Error boundary -->
<script>
    window.addEventListener('error', (event) => {
        console.error('Login page error:', event.error);

        // Show user-friendly error
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = '
        position: fixed; top: 20px; left: 20px; right: 20px;
        background: #fee; border: 1px solid #fcc; color: #c66;
        padding: 15px; border-radius: 5px; z-index: 10001;
        font-family: system-ui, sans-serif;
    ';
        errorDiv.innerHTML = '
        <strong>⚠️ Login Error</strong><br>
        Something went wrong. Please refresh the page.<br>
        <button onclick="window.location.reload()" style="margin-top: 10px; padding: 5px 10px;">
            🔄 Refresh Page
        </button>
    ';
        document.body.appendChild(errorDiv);
    });
</script>
</body>
</html>